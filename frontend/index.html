<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="../css/index.css">
  
  <meta charset="utf-8">
  <script type="text/javascript" src="../d3/d3.v7.js"></script>
  <!-- <script src="https://d3js.org/d3.v7.min.js"></script> -->
</head>
<body>
    <h1>
        CSE 332 PROJECT 2 <br>
        Adam Feng
    </h1>
  <div>
    <div>
        Choose Visualization:
        <button id="bar">Bar Chart/Histogram</button>
        <button id="pie">Pie Chart</button>
        <button id="scatter">Scatter Plot</button>
        <button id="sources">Sources</button>
    </div>
    <div id="main"> 

    </div>
        <div id="chart-container">
            <div id="graph"></div>
            <div id="legend"></div> 
        </div>
        <div id="tooltip"></div>

    <script>
        //got from https://d3-graph-gallery.com/graph/histogram_binSize.html and modified to fit website
        const margin = {top: 30, right: 200, bottom: 150, left: 200},
            width = 2000 - margin.left - margin.right,
            height = 1000 - margin.top - margin.bottom;

        const units = [
            { varName: 'Last Round Single Time', unit: "seconds"},
            { varName: 'Last Round Average Time', unit: "seconds"},
            { varName: 'Completed Solves', unit: "Solves"},
            { varName: 'Rounds Competed', unit: "Rounds"},
            { varName: 'Best Single Time', unit: "seconds"},
            { varName: 'Best Average Time', unit: "seconds"},
            { varName: 'Number of Competitors', unit: "Competitors"},
            { varName: 'Number of Penalties', unit: "Penalties"},
            { varName: 'Number of Competitions', unit: "Competitions"},
        ]

        function getUnit(varName) {
            const found = units.find(function(i){
                console.log(i.unit)
                return i.varName == varName
            });
            console.log("FOUND", found)
            return found ? found.unit : ''; 
        }
        
        window.onload = function(){
            document.getElementById("bar").onclick = function(){
                displayBar();
            };

            document.getElementById("scatter").onclick = function(){
                document.getElementById("graph").innerHTML =``;
                displayScatter();
            };

            document.getElementById("pie").onclick = function(){
                document.getElementById("graph").innerHTML =``;
                displayPie();
            };

            document.getElementById("sources").onclick = function(){
                document.getElementById("graph").innerHTML =``;
                displaySources();
            };
        }

        function displaySources(){
            document.getElementById("legend").innerHTML =``;
            document.getElementById("main").innerHTML =
            `
                <h1>
                    Sources Used
                </h1>

                <ul>
                    <li> 
                        <a href="https://stackoverflow.com/questions/42285441/how-to-read-in-csv-with-d3-v4">How to read in CSV with d3 v4?</a>
                        <p>
                            &emsp; I used this source to understand and use the .csv function from d3 to get the data from my csv file.
                        </p>
                    </li>
                    <li> 
                        <a href="https://chatgpt.com">ChatGPT</a>
                        <p>
                            &emsp; I used this source to debug, create templates, general help for explaining how the templates and functions worked, and styling .
                        </p>
                    </li>
                    <li> 
                        <a href="https://d3-graph-gallery.com/graph/pie_annotation.html">Pie chart with annotation</a>
                        <p>
                            &emsp; I used this as a template to create my Pie Charts.
                        </p>
                    </li>
                    <li> 
                        <a href="https://observablehq.com/@mast4461/d3-donut-chart-labels">D3 Donut Chart Labels</a>
                        <p>
                            &emsp; I used this as a template to create my labels on the Pie Charts with the poly lines and text. 
                            <br>&emsp; There is a current issue that the template has with overlapping text and I attempted to fix it but with little to no progress.
                        </p>
                    </li>
                    <li> 
                        <a href="https://d3js.org/d3-shape/pie">D3 Pies Function</a>
                        <p>
                            &emsp; I used this source to learn about the pie function and to create my own function to input the value element.
                        </p>
                    </li>
                    <li> 
                        <a href="https://medium.com/@kj_schmidt/show-data-on-mouse-over-with-d3-js-3bf598ff8fc2">Show data on mouse-over with d3.js</a>
                        <p>
                            &emsp; I used this source as a template for my mouseover and mouseout functions.
                        </p>
                    </li>
                    <li> 
                        <a href="https://gist.github.com/dbuezas/9306799?permalink_comment_id=3768736#gistcomment-3768736">Pie charts labels</a>
                        <p>
                            &emsp; This was another source for the text labels and polylines I created for the Pie Charts.
                        </p>
                    </li>
                    <li> 
                        <a href="https://www3.cs.stonybrook.edu/~mueller/teaching/cse332/CSE%20332%20basic%20tasks%202023.pdf">Binning Formula</a>
                        <p>
                            &emsp; I used the slides to create the Bin Size I wanted for Scatter Plot, Histogram, and Bar Chart.
                        </p>
                    </li>
                    <li> 
                        <a href="https://observablehq.com/@d3/d3-bin">D3 Binning</a>
                        <p>
                            &emsp; I used this source to understand the D3 binning function to bin for Scatter Plot, Histogram, and Pie Chart.
                        </p>
                    </li>
                    </li>
                    <li> 
                        <a href="https://d3js.org/d3-array/bin#bin_thresholds">D3 Thresholds</a>
                        <p>
                            &emsp; I used this source to understand the D3 thresholds function to create custom tick marks for Scatter Plot and Histogram.
                            <br>&emsp; I also used the source to input a thresholds array for binning.
                        </p>
                    </li>
                    <li> 
                        <a href="https://d3-graph-gallery.com/graph/histogram_binSize.html">Histogram with variable bin size</a>
                        <p>
                            &emsp; I used this source as a template for my Histogram.
                        </p>
                    </li>
                    <li> 
                        <a href="https://stackoverflow.com/questions/11189284/d3-axis-labeling">D3 axis labeling</a>
                        <p>
                            &emsp; I used this source as a template to add axes labeling to my Scatter Plot, Bar Chart, and Histogram.
                        </p>
                    </li>
                    <li> 
                        <a href="https://d3-graph-gallery.com/graph/scatter_basic.html">Basic scatterplot in d3.js</a>
                         <p>
                            &emsp; I used this source as a template for my Scatter Plot.
                        </p>
                    </li>
                    <li> 
                        <a href="https://d3-graph-gallery.com/graph/barplot_basic.html">Most basic barplot in d3.js</a>
                        <p>
                            &emsp; I used this source as a template for my Bar Chart.
                        </p>
                    </li>
                    <li> 
                        <a href="https://www.codecademy.com/resources/docs/d3/selection/csv">D3.js d3.csv() Function</a>
                        <p>
                            &emsp; I also used this source to learn about the csv function and how to parse through the data in my csv file
                        </p>
                    </li>
                    <li> 
                        <a href="https://www.geeksforgeeks.org/d3-js-axis-tickvalues-function/#">D3.js axis.tickValues() Function</a>
                        <p>
                            &emsp; I used this source to learn how to create custom tick mark values in the X axis of my Histogram.
                        </p>
                    </li>
                    <li> 
                        <a href="https://d3js.org/d3-axis">D3.js Axis Functions</a>
                        <p>
                            &emsp; I used this source to learn how to create a custom number of tick marks on my X axis of the Histogram.
                            <br> &emsp; I also used this source to learn more about the ticks function and how to use my threshold array to create the custom x axis values.
                        </p>
                    </li>
                </ul>
            `
        }

        function displayPie(){
            document.getElementById("legend").innerHTML =``;
            document.getElementById("main").innerHTML =
            `
                <h1>
                    Pie Chart Visualization
                </h1>
                    <label for="cars">Choose a variable:</label>
                    <!-- categorical
                    name
                    gender
                    representation
                    competition
                    lastround
                    -->
                    <!-- numerical
                    completed solves
                    rank
                    last round time
                    last round avg time
                    how many rounds
                    single time
                    avg time
                    number of comp
                    competitors
                    penalties-->
                    <div>
                    <select name="variables" id="variables">
                        <option value="Name">Name</option>
                        <option value="Gender">Gender</option>
                        <option value="Representation">Representation</option>
                        <option value="Competition">Competition</option>
                        <option value="Last Round">Last Round</option>
                        <option value="Rank">Rank</option>
                        <option value="Last Round Single Time">Last Round Single Time</option>
                        <option value="Last Round Average Time">Last Round Average Time</option>
                        <option value="Completed Solves">Completed Solves</option>
                        <option value="Rounds Competed">Rounds Competed</option>
                        <option value="Best Single Time">Best Single Time</option>
                        <option value="Best Average Time">Best Average Time</option>
                        <option value="Number of Competitions">Number of Competitions</option>
                        <option value="Number of Competitors">Number of Competitors</option>
                        <option value="Number of Penalties">Number of Penalties</option>
                    </select>
                    </div>
            `
            //got function of using .csv from https://stackoverflow.com/questions/42285441/how-to-read-in-csv-with-d3-v4
            //Another source used: https://www.codecademy.com/resources/docs/d3/selection/csv
            d3.csv("../csvData/updatedData.csv").then(function(data) {
                console.log(data);
                updatePie('Name', data);

                d3.select("#variables").on('change', function(){
                    const varName = document.getElementById('variables').value;
                    console.log(varName);
    
                    updatePie(varName, data);
                });
            })
        }

        function updateLegend(data, type) {
            //got idea of updating and adding legend for pie chart as an outside function because putting it in updatePie was not displaying it properly
            //SOURCE: CHATGPT
            document.getElementById("legend").innerHTML =``;
            const width = 1000; 
            const height = 1000; 
        
            const svg = d3.select("#legend")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(0, 0)`);
        
            //console.log(data);
            const color = d3.scaleOrdinal(d3.schemeSet3);
            let legendData;
            if(!type){
                legendData = data.map(function(d, i){ 
                    return{
                        name: d.data[0],
                        color: color(d.data[0]),
                        index: i,
                    }
                });
            }
            else{
                legendData = data.map(function(d, i){ 
                    //console.log("DATA", d)
                    return{
                        name: d.data.intervals,
                        color: color(d.data.intervals),
                        index: i,
                    }
                });
            }

            //console.log(legendData);
            //used Chatgpt to get template of legend
            //Source: CHATGPT
            const legendItems = svg.selectAll('.legend-item')
                .data(legendData)
                .enter()
                .append('g')
                .attr('class', 'legend-item')
                .attr('transform', function(d){
                    return `translate(0, ${d.index * 25})`
                }); 
        
            legendItems.append('rect')
                .attr('x', 10) 
                .attr('y', 0)
                .attr('width', 18)
                .attr('height', 18)
                .attr('fill', function(d){
                    //console.log(d.color)
                    return d.color;
                })
        
            legendItems.append('text')
                .attr('x', 30)
                .attr('y', 12) 
                .text(function(d){
                    //console.log(d.name)
                    return d.name;
                })
                .style("font-size", 14);
        }

        function updatePie(varName, data){
            document.getElementById("graph").innerHTML =``;
            const tooltip = document.getElementById("tooltip");

            const counts = new Map();
            data.forEach(function(d) {
                const value = d[varName];
                if(counts.has(value)){
                    counts.set(value, counts.get(value)+ 1);
                }
                else{
                    if((varName === 'Last Round Average Time' && value == 'DNF') || value === ""){
                        return;                         
                    }
                    counts.set(value, 1);
                }
            });

            const newData = [];
            data.forEach(function(d){
                const value = d[varName];
                if((varName === 'Last Round Average Time' && value == 'DNF') || value === ""){
                    return;                         
                }
                newData.push(value);
            })

            const valueArray = Array.from(counts, function(array){
                if(Number(array[0]) == 0){
                    console.log(array)
                }
                return Number(array[0]);
            });

            console.log("COUNTS", counts);


            const isNumerical = !isNaN(+data[0][varName]);
    
            //console.log("SHOWING COUNTS",  orderedCounts);
            
            //Used d3 template: https://d3-graph-gallery.com/graph/pie_annotation.html
            //Another source used for outArc lines (labels & polylines): https://observablehq.com/@mast4461/d3-donut-chart-labels
            const radius = Math.min(width, height) / 2 - margin.bottom
            const svg = d3.select("#graph")
                .append("svg")
                .attr("width", width-300)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${width / 2}, ${height / 2})`);
            
            const arcGenerator = d3.arc()
                .innerRadius(0)
                .outerRadius(radius)
            
            const outerArc = d3
                .arc()
                .innerRadius(radius * 1.1)
                .outerRadius(radius * 1.1);
            
            svg.append("g")
                .attr("class", "slices");
            svg.append("g")
                .attr("class", "labels");
            svg.append("g")
                .attr("class", "lines");

            if(!isNumerical){
                orderedCounts = Array.from(counts).sort(function(a, b){
                    return b[1] - a[1];
                })
    
                const top5 = orderedCounts.slice(0,5);
                let sum = 0;
                for(const x of top5){
                    console.log(x[1]);
                    sum += x[1];
                }
                
                const other = data.length - sum;
    
                if(other > 0){
                    top5.push(['Others', other]);
                }

                //Used source to create custom pie function: https://d3js.org/d3-shape/pie
                const pie1 = d3.pie()
                    .value(function(d){
                        return d[1];
                    })
                
                data_ready = pie1(top5);
                
                color = d3.scaleOrdinal()
                    .domain(top5.map(function(d){
                        return d[0];
                    }))
                    .range(d3.schemeSet3);
                
                updateLegend(data_ready, isNumerical);
                
                //Used d3 template: https://d3-graph-gallery.com/graph/pie_annotation.html
                svg.selectAll('mySlices')
                    .data(data_ready)
                    .join('path')
                    .attr('d', arcGenerator)
                    .attr('fill', function(d){ return(color(d.data[0])) })
                    .attr("stroke", "black")
                    .style("stroke-width", "2px")
                    .style("opacity", 0.7)
                    //used source to create on hover tooltip popup: https://medium.com/@kj_schmidt/show-data-on-mouse-over-with-d3-js-3bf598ff8fc2
                    .on("mouseover", function(event, d){
                        //console.log("MOUSE OVER")
                        let num = d.data[0]+ ', ' + d.data[1];
                        console.log(num);
                        tooltip.innerHTML = `${num}`;
                        tooltip.style.left=(event.pageX + 15)  + "px";
                        tooltip.style.top= (event.pageY - 28)  + "px";
                        tooltip.style.visibility="visible";

                        d3.select(this)
                        .transition()
                        .duration(300)
                        .attr('opacity', '.85')
                        .attr('d', d3.arc()
                            .innerRadius(0)  
                            .outerRadius(radius + 10)
                            );
                    })
                    .on("mouseout", function(event, d) {
                        //console.log(arcGenerator);
                        d3.select(this)
                            .transition()
                            .duration(300)
                            .attr('d', arcGenerator);
                        tooltip.style.visibility="hidden";
                    });
                //Got template of polyline & text labels from https://observablehq.com/@mast4461/d3-donut-chart-labels/
                //Same template used but on github: https://gist.github.com/dbuezas/9306799?permalink_comment_id=3768736#gistcomment-3768736
                svg.selectAll('labels')
                    .data(data_ready)
                    .join('text')
                    .text(function(d){
                        //console.log(d.data[0])
                        return d.data[0]
                    })
                    .attr("transform", function(d) { 
                        let position = outerArc.centroid(d)
                        position[0] = radius *  1.2 * (midAngle(d) < Math.PI ? 1 : -1);
                        //position[1] = radius  * position[1] / Math.abs(position[1]);
                        //console.log(position)
                        return "translate("+ position +")"})
                    .style("text-anchor", "middle")
                    .attr("dy", "0.35em")
                    .style("font-size", 17)

                svg.select(".lines").selectAll("polyline")
                    .data(data_ready)
                    .enter()
                    .append("polyline")
                    .attr('points', function(d) {
                        const pos = arcGenerator.centroid(d);
                        const outsidePos = outerArc.centroid(d);
                        //console.log(outsidePos, d)
                        outsidePos[0] = (radius * (midAngle(d) < Math.PI ? 1 : -1)); // Position outside pie
                        return [pos, outerArc.centroid(d), outsidePos]; // Draw line from slice to outside text
                    })
                    .style('fill', 'none')
                    .style('stroke', 'black')
                    .style('stroke-width', 1);
            }
            else{
                const max = Math.max(...valueArray);
                const min = Math.min(...valueArray);
                //binSize formula from slides: https://www3.cs.stonybrook.edu/~mueller/teaching/cse332/CSE%20332%20basic%20tasks%202023.pdf
                let binSize = ((max - min)/5);
                console.log("BIN SIZE PIE", binSize);
                const thresholds = [];
                let newBinSize;
                let domainMax = max + binSize;

                if(varName == 'Rank' || varName == 'Completed Solves'|| varName == 'Rounds Competed' 
                || varName == 'Number of Competitions' || varName == 'Number of Competitors' || varName == 'Number of Penalties'){
                    if(varName == 'Rounds Competed' || varName == 'Number of Penalties'){
                        newBinSize = 1;
                        domainMax = max + newBinSize;
                    }
                    else{
                        newBinSize = Math.round(binSize);
                        domainMax = max + newBinSize;
                        console.log(newBinSize);
                    }

                    for (let i = min; i <= domainMax; i += newBinSize) {
                        thresholds.push(i);
                    }
                }
                else{
                    for (let i = min; i <= domainMax; i += binSize) {
                        thresholds.push(parseFloat(i.toFixed(2)));
                    }
                }
                //Used source to understand binning and creating my own thresholds: https://observablehq.com/@d3/d3-bin
                //Another Source used: https://d3js.org/d3-array/bin#bin_thresholds
                const bin1 = d3.bin()
                    .domain([min, parseFloat((max+ binSize).toFixed(2))])
                    .thresholds(thresholds);
            
                const bins = bin1(newData);
        
                const binnedData = bins.filter(function(value){
                    return value.length > 0
                })
                .map(function(value){
                    return {
                        intervals: `${value.x0}-${value.x1}`,
                        count: value.length
                    }
                })

                //console.log(binnedData);
                //Used source to create custom pie function: https://d3js.org/d3-shape/pie
                pie1 = d3.pie()
                .value(function(d){
                    return d.count;
                })
    
                data_ready = pie1(binnedData)
                
                updateLegend(data_ready, isNumerical);

                color = d3.scaleOrdinal()
                    .range(d3.schemeSet3);
                
                //Used d3 template: https://d3-graph-gallery.com/graph/pie_annotation.html
                svg.selectAll('mySlices')
                    .data(data_ready)
                    .join('path')
                    .attr('d', arcGenerator)
                    .attr('fill', function(d){ return(color(d.data.intervals)) })
                    .attr("stroke", "black")
                    .style("stroke-width", "2px")
                    .style("opacity", 0.7)
                    //used source to create on hover tooltip popup: https://medium.com/@kj_schmidt/show-data-on-mouse-over-with-d3-js-3bf598ff8fc2
                    .on("mouseover", function(event, d){
                    //console.log("MOUSE OVER")
                        const unit = ' ' + getUnit(varName)
                        //console.log(event);
                        let num = d.data.intervals + unit + ', ' + d.data.count;
                        console.log(num);
                        tooltip.innerHTML = `${num}`;
                        tooltip.style.left=(event.pageX + 15)  + "px";
                        tooltip.style.top= (event.pageY - 28)  + "px";
                        tooltip.style.visibility="visible";

                        d3.select(this)
                        .transition()
                        .duration(300)
                        .attr('opacity', '.85')
                        .attr('d', d3.arc()
                            .innerRadius(0)  
                            .outerRadius(radius + 10)
                            );
                    })
                    .on("mouseout", function(event, d) {
                    //console.log(arcGenerator);
                        d3.select(this)
                            .transition()
                            .duration(300)
                            .attr('d', arcGenerator);
                        tooltip.style.visibility="hidden";
                    });
            
            //Got template of polyline & text labels from https://observablehq.com/@mast4461/d3-donut-chart-labels/
            //Same template used but on github: https://gist.github.com/dbuezas/9306799?permalink_comment_id=3768736#gistcomment-3768736
            svg.selectAll('labels')
                .data(data_ready)
                .join('text')
                .text(function(d){
                   //console.log(d.data.intervals)
                    return d.data.intervals
                })
                .attr("transform", function(d) { 
                    let position = outerArc.centroid(d)
                    position[0] = radius *  1.2 * (midAngle(d) < Math.PI ? 1 : -1);
                    //position[1] = radius  * position[1] / Math.abs(position[1]);
                    //console.log(position)
                    return "translate("+ position +")"})
                .style("text-anchor", "middle")
                .attr("dy", "0.35em")
                .style("font-size", 17)
            
            svg.select(".lines").selectAll("polyline")
                .data(data_ready)
                .enter()
                .append("polyline")
                .attr('points', function(d) {
                    const pos = arcGenerator.centroid(d);
                    const outsidePos = outerArc.centroid(d);
                    //console.log(outsidePos, d)
                    outsidePos[0] = (radius * (midAngle(d) < Math.PI ? 1 : -1)); // Position outside pie
                    return [pos, outerArc.centroid(d), outsidePos]; // Draw line from slice to outside text
                })
                .style('fill', 'none')
                .style('stroke', 'black')
                .style('stroke-width', 1);

            }

            //function from https://observablehq.com/@mast4461/d3-donut-chart-labels/ but modified in attempt to avoid text overlapping
            function midAngle(d){
                //console.log((d.endAngle - d.startAngle)/2)
                if((d.endAngle - d.startAngle)/2 < 0.05){
                    return (d.endAngle - d.startAngle)/2;
                }
                return d.startAngle + (d.endAngle - d.startAngle)/2;
            }
        }

        function displayScatter(){
            document.getElementById("legend").innerHTML =``;
            document.getElementById("main").innerHTML =
            `
                <h1>
                    Scatter Plot Visualization
                </h1>
                <div id="allRadios">
                    <div class="radioHolder">
                        <h3>Select X Variable</h3>
                        <div id='radioX' class="radioGroup">
                            <label><input type="radio" name="xVariable" class="Cat" value="Name" checked> Name</label>
                            <label><input type="radio" name="xVariable" class="Cat" value="Gender"> Gender</label>
                            <label><input type="radio" name="xVariable" class="Cat" value="Representation"> Representation</label>
                            <label><input type="radio" name="xVariable" class="Cat" value="Competition"> Competition</label>
                            <label><input type="radio" name="xVariable" class="Cat" value="Last Round"> Last Round</label>
                            <label><input type="radio" name="xVariable" class="Num" value="Rank">Rank</label>
                            <label><input type="radio" name="xVariable" class="Num" value="Last Round Single Time">Last Round Single Time</label>
                            <label><input type="radio" name="xVariable" class="Num" value="Last Round Average Time">Last Round Average Time</label>
                            <label><input type="radio" name="xVariable" class="Num" value="Completed Solves">Completed Solves</label>
                            <label><input type="radio" name="xVariable" class="Num" value="Rounds Competed">Rounds Competed</label>
                            <label><input type="radio" name="xVariable" class="Num" value="Best Single Time">Best Single Time</label>
                            <label><input type="radio" name="xVariable" class="Num" value="Best Average Time">Best Average Time</label>
                            <label><input type="radio" name="xVariable" class="Num" value="Number of Competitions">Number of Competitions</label>
                            <label><input type="radio" name="xVariable" class="Num" value="Number of Competitors">Number of Competitors</label>
                            <label><input type="radio" name="xVariable" class="Num" value="Number of Penalties">Number of Penalties</label>
                        </div>
                    </div>

                    <div class="radioHolder">
                        <h3>Select Y Variable</h3>
                        <div id='radioY' class="radioGroup">
                            <label><input type="radio" name="yVariable" class="Cat" value="Name"> Name</label>
                            <label><input type="radio" name="yVariable" class="Cat" value="Gender"> Gender</label>
                            <label><input type="radio" name="yVariable" class="Cat" value="Representation"> Representation</label>
                            <label><input type="radio" name="yVariable" class="Cat" value="Competition"> Competition</label>
                            <label><input type="radio" name="yVariable" class="Cat" value="Last Round"> Last Round</label>
                            <label><input type="radio" name="yVariable" class="Num" value="Rank">Rank</label>
                            <label><input type="radio" name="yVariable" class="Num" value="Last Round Single Time" checked>Last Round Single Time</label>
                            <label><input type="radio" name="yVariable" class="Num" value="Last Round Average Time">Last Round Average Time</label>
                            <label><input type="radio" name="yVariable" class="Num" value="Completed Solves">Completed Solves</label>
                            <label><input type="radio" name="yVariable" class="Num" value="Rounds Competed">Rounds Competed</label>
                            <label><input type="radio" name="yVariable" class="Num" value="Best Single Time">Best Single Time</label>
                            <label><input type="radio" name="yVariable" class="Num" value="Best Average Time">Best Average Time</label>
                            <label><input type="radio" name="yVariable" class="Num" value="Number of Competitions">Number of Competitions</label>
                            <label><input type="radio" name="yVariable" class="Num" value="Number of Competitors">Number of Competitors</label>
                            <label><input type="radio" name="yVariable" class="Num" value="Number of Penalties">Number of Penalties</label>
                        </div>
                    </div>
                </div>
            `
            //Asked ChatGpt how to restrict corresponding y/x variable when other is clicked
            //SOURCE: CHATGPT
            const xRadios = document.getElementsByName("xVariable");
            const yRadios = document.getElementsByName("yVariable");
            let selected = updateNewRadio(xRadios, yRadios);
            
            //got function of using .csv from https://stackoverflow.com/questions/42285441/how-to-read-in-csv-with-d3-v4
            //Another source used: https://www.codecademy.com/resources/docs/d3/selection/csv
            d3.csv("../csvData/updatedData.csv").then(function(data) {
                console.log(data);
                updateScatter(selected[0], selected[1], data);
            
            //console.log(xRadios);
                for(const x of xRadios){
                    x.onclick = function(){
                        selected = updateNewRadio(xRadios, yRadios);
                        updateScatter(selected[0], selected[1], data);
                    }
                }

                for(const y of yRadios){
                    y.onclick = function(){
                        selected = updateNewRadio(xRadios, yRadios);
                        updateScatter(selected[0], selected[1], data);
                    }
                }
            })

        }

        function updateScatter(var1, var2, data){
            document.getElementById("graph").innerHTML =``;
            const tooltip = document.getElementById("tooltip");
            console.log(var1);
            const unit1 = ' ' + getUnit(var1.selectedX)
            const unit2 = ' ' + getUnit(var2.selectedY)
            let labelMarginY = 130;
            let labelMarginX = 90;

            if(var2.selectedY == 'Competition' || var2.selectedY == 'Name'){
                labelMarginY = 10;
            }
            if(var1.selectedX == 'Competition' || var1.selectedX == 'Name'){
                labelMarginX = 10;
            }

            const countsX = new Map();
            data.forEach(function(d) {
                const value = d[var1.selectedX];
                if(countsX.has(value)){
                    countsX.set(value, countsX.get(value)+ 1);
                }
                else{
                    if((var1.selectedX === 'Last Round Average Time' && value == 'DNF') || value === ""){
                        return;                         
                    }
                    countsX.set(value, 1);
                }
            });

            const valueArrayX = Array.from(countsX, function(array){
                if(Number(array[0]) == 0){
                    console.log(array)
                }
                return Number(array[0]);
            });

            const maxX = Math.max(...valueArrayX);
            const minX = Math.min(...valueArrayX);

            const countsY = new Map();
            data.forEach(function(d) {
                const value = d[var2.selectedY];
                if(countsY.has(value)){
                    countsY.set(value, countsY.get(value)+ 1);
                }
                else{
                    if((var2.selectedY === 'Last Round Average Time' && value == 'DNF') || value === ""){
                        return;                         
                    }
                    countsY.set(value, 1);
                }
            });
            //should simplify

            const valueArrayY = Array.from(countsY, function(array){
                if(Number(array[0]) == 0){
                    console.log(array)
                }
                return Number(array[0]);
            });

            const maxY = Math.max(...valueArrayY);
            const minY = Math.min(...valueArrayY);

            //Template got from: https://d3-graph-gallery.com/graph/scatter_basic.html
            const svg = d3.select("#graph")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            const isNumerical = var1.xClass == 'Num' && var2.yClass == 'Num';
            const bothCat = var1.xClass == 'Cat' && var2.yClass == 'Cat';
            if(isNumerical){    
                const x = d3.scaleLinear()
                    .domain([0, maxX])
                    .range([ 0, width ]);
                
                //labeling from: https://stackoverflow.com/questions/11189284/d3-axis-labeling
                svg.append("text")
                    .attr("text-anchor", "middle")
                    .attr("x", width / 2)
                    .attr("y", height + margin.bottom - labelMarginX)
                    .text(var1.selectedX + ' (' + unit1.substring(1) + ')')
                    .style("font-size", "17px")
                    .style("font-weight", "bold");

                svg.append("g")
                    .attr("transform", `translate(0, ${height})`)
                    .call(d3.axisBottom(x))
                    .selectAll("text")

                const y = d3.scaleLinear()
                    .domain([0, maxY])
                    .range([ height, 0]);

                svg.append("g")
                    .call(d3.axisLeft(y));
                
                //labeling from: https://stackoverflow.com/questions/11189284/d3-axis-labeling
                svg.append("text")
                    .attr("text-anchor", "middle")
                    .attr("x", -height / 2) 
                    .attr("y", -margin.left+labelMarginY)
                    .attr("transform", "rotate(-90)")
                    .text(var2.selectedY + ' (' + unit2.substring(1) + ')')
                    .style("font-size", "17px")
                    .style("font-weight", "bold");

                svg.append('g')
                    .selectAll("dot")
                    .data(data.filter(function(d){
                        return  d[var1.selectedX] !== 'DNF' && d[var1.selectedX] !== ""
                                && d[var2.selectedY] !== 'DNF' && d[var2.selectedY] !== ""
                    }))
                    .join("circle")
                    .attr("cx", function (d) { 
                        //console.log(d[var1.selectedX]);
                        return x(+d[var1.selectedX]); } )
                    .attr("cy", function (d) { return y(+d[var2.selectedY]); } )
                    .attr("r", 5)
                    .attr('opacity', '.55')
                    .style("fill", "#69b3a2")
                    //used source to create on hover tooltip popup: https://medium.com/@kj_schmidt/show-data-on-mouse-over-with-d3-js-3bf598ff8fc2
                    .on("mouseover", function(event, d){
                        let num =  +d[var1.selectedX] + unit1 + ', ' + +d[var2.selectedY] + unit2;
                        console.log(num);
                        tooltip.innerHTML = `${num}`;
                        tooltip.style.left=(event.pageX + 15)  + "px";
                        tooltip.style.top= (event.pageY - 28)  + "px";
                        tooltip.style.visibility="visible";
    
                        d3.select(this)
                            .transition()
                            .duration(300)
                            .attr('opacity', '.85')
                            .style('fill', '#D397F8') 
                            .attr('stroke', 'black')
                            .attr("r", 15)
                            .attr('stroke-width', 2);
                        })
                        .on("mouseout", function(event, d) {
                        //console.log(arcGenerator);
                            d3.select(this)
                                .transition()
                                .duration(500)
                                .style("fill", "#69b3a2")
                                .attr('stroke', 'none')
                                .attr("r", 5)
                            tooltip.style.visibility="hidden";
                        });
            }
            else if(bothCat){
                //Template got from: https://d3-graph-gallery.com/graph/scatter_basic.html
                const x = d3.scaleBand()
                    .range([ 0, width ])
                    .domain(data.map(function(d) {
                        return d[var1.selectedX]; }))
                    .padding(0.2);
                console.log("IM IN HERE")
                
                //labeling from: https://stackoverflow.com/questions/11189284/d3-axis-labeling
                svg.append("text")
                    .attr("text-anchor", "middle")
                    .attr("x", width / 2)
                    .attr("y", height + margin.bottom - labelMarginX)
                    .text(var1.selectedX)
                    .style("font-size", "17px")
                    .style("font-weight", "bold");

                svg.append("g")
                    .attr("transform", `translate(0, ${height})`)
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .style("text-anchor", "end")
                    .attr("dx", "-0.8em")
                    .attr("dy", "0.15em")
                    .attr("transform", "rotate(-45)");  

                    // Add Y axis
                const y = d3.scaleBand()
                    .range([ height, 0])
                    .domain(data.map(function(d) {
                        return d[var2.selectedY]; }))
                    .padding(0.2);

                svg.append("g")
                    .call(d3.axisLeft(y));
                
                //labeling from: https://stackoverflow.com/questions/11189284/d3-axis-labeling
                svg.append("text")
                    .attr("text-anchor", "middle")
                    .attr("x", -height / 2) 
                    .attr("y", -margin.left+labelMarginY)
                    .attr("transform", "rotate(-90)")
                    .text(var2.selectedY)
                    .style("font-size", "17px")
                    .style("font-weight", "bold");

                    // Add dots
                svg.append('g')
                    .selectAll("dot")
                    .data(data)
                    .join("circle")
                    .attr("cx", function (d) { 
                        const jitter = (Math.random() - 0.5) *  x.bandwidth() * 0.7;
                        return x(d[var1.selectedX]) + x.bandwidth() / 2 + jitter; } )
                    .attr("cy", function (d) {
                        const jitter = (Math.random() - 0.5) * y.bandwidth() * 0.7;
                        return y(d[var2.selectedY]) + y.bandwidth() / 2 + jitter; } )
                    .style("fill", "#69b3a2")
                    .attr("r", 5)
                    .attr('opacity', '.55')
                    .on("mouseover", function(event, d){
                        //used source to create on hover tooltip popup: https://medium.com/@kj_schmidt/show-data-on-mouse-over-with-d3-js-3bf598ff8fc2
                        let num =  d[var1.selectedX] + ', ' + d[var2.selectedY];
                        console.log(num);
                        tooltip.innerHTML = `${num}`;
                        tooltip.style.left=(event.pageX + 15)  + "px";
                        tooltip.style.top= (event.pageY - 28)  + "px";
                        tooltip.style.visibility="visible";
    
                            d3.select(this)
                            .transition()
                            .duration(300)
                            .attr('opacity', '.85')
                            .style('fill', '#D397F8') 
                            .attr('stroke', 'black')
                            .attr("r", 15)
                            .attr('stroke-width', 2);
                        })
                        .on("mouseout", function(event, d) {
                        //console.log(arcGenerator);
                            d3.select(this)
                                .transition()
                                .duration(500)
                                .style("fill", "#69b3a2")
                                .attr('stroke', 'none')
                                .attr("r", 5)
                            tooltip.style.visibility="hidden";
                        });
            }
            else{
                //Template got from: https://d3-graph-gallery.com/graph/scatter_basic.html
                let x;
                let y;
                if(var1.xClass == 'Cat'){
                    x = d3.scaleBand()
                        .range([ 0, width ])
                        .domain(data.map(function(d) {
                            return d[var1.selectedX]; }))
                        .padding(0.2);
                    
                    y = d3.scaleLinear()
                        .domain([0, maxY])
                        .range([ height, 0]);
                    
                    //labeling from: https://stackoverflow.com/questions/11189284/d3-axis-labeling
                    svg.append("text")
                        .attr("text-anchor", "middle")
                        .attr("x", width / 2)
                        .attr("y", height + margin.bottom - labelMarginX)
                        .text(var1.selectedX)
                        .style("font-size", "17px")
                        .style("font-weight", "bold");
                    
                    svg.append("text")
                        .attr("text-anchor", "middle")
                        .attr("x", -height / 2) 
                        .attr("y", -margin.left+labelMarginY)
                        .attr("transform", "rotate(-90)")
                        .text(var2.selectedY + ' (' + unit2.substring(1) + ')')
                        .style("font-size", "17px")
                        .style("font-weight", "bold");
                    
                }
                else if(var1.xClass == 'Num'){
                    x = d3.scaleLinear()
                        .domain([0, maxX])
                        .range([ 0, width ]);
                    
                    y = d3.scaleBand()
                        .range([ height, 0])
                        .domain(data.map(function(d) {
                            return d[var2.selectedY]; }))
                        .padding(0.2);
                    
                    //labeling from: https://stackoverflow.com/questions/11189284/d3-axis-labeling
                    svg.append("text")
                        .attr("text-anchor", "middle")
                        .attr("x", width / 2)
                        .attr("y", height + margin.bottom - labelMarginX)
                        .text(var1.selectedX + ' (' + unit1.substring(1) + ')')
                        .style("font-size", "17px")
                        .style("font-weight", "bold");
                    
                    svg.append("text")
                        .attr("text-anchor", "middle")
                        .attr("x", -height / 2) 
                        .attr("y", -margin.left+labelMarginY)
                        .attr("transform", "rotate(-90)")
                        .text(var2.selectedY)
                        .style("font-size", "17px")
                        .style("font-weight", "bold");
                }

                svg.append("g")
                    .attr("transform", `translate(0, ${height})`)
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .style("text-anchor", "end")
                    .attr("dx", "-0.8em")  // Adjust label distance from axis
                    .attr("dy", "0.15em")  // Adjust label vertical offset
                    .attr("transform", "rotate(-45)"); 
                
                svg.append("g")
                    .call(d3.axisLeft(y));

                if(var1.xClass == 'Cat'){
                    svg.append('g')
                    .selectAll("dot")
                    .data(data.filter(function(d){
                        return d[var1.selectedX] !== 'DNF' && d[var1.selectedX] !== ""
                                && d[var2.selectedY] !== 'DNF' && d[var2.selectedY] !== ""
                    }))
                    .join("circle")
                    .attr("cx", function (d) { 
                        //onst jitter = (Math.random() - 0.5) *  x.bandwidth() * 0.7;
                        return x(d[var1.selectedX]) + x.bandwidth() / 2 ; } )
                    .attr("cy", function (d) {return y(+d[var2.selectedY])})
                    .style("fill", "#69b3a2")
                    .attr("r", 5)
                    .attr('opacity', '.55')
                    .on("mouseover", function(event, d){
                        //used source to create on hover tooltip popup: https://medium.com/@kj_schmidt/show-data-on-mouse-over-with-d3-js-3bf598ff8fc2
                        let num =  d[var1.selectedX] + ', ' + d[var2.selectedY];
                        console.log(num);
                        tooltip.innerHTML = `${num}`;
                        tooltip.style.left=(event.pageX + 15)  + "px";
                        tooltip.style.top= (event.pageY - 28)  + "px";
                        tooltip.style.visibility="visible";
    
                            d3.select(this)
                            .transition()
                            .duration(300)
                            .attr('opacity', '.85')
                            .style('fill', '#D397F8') 
                            .attr('stroke', 'black')
                            .attr("r", 15)
                            .attr('stroke-width', 2);
                        })
                        .on("mouseout", function(event, d) {
                        //console.log(arcGenerator);
                            d3.select(this)
                                .transition()
                                .duration(500)
                                .style("fill", "#69b3a2")
                                .attr('stroke', 'none')
                                .attr("r", 5)
                            tooltip.style.visibility="hidden";
                        });
                }
                else if(var1.xClass == 'Num'){
                    svg.append('g')
                    .selectAll("dot")
                    .data(data.filter(function(d){
                        return d[var1.selectedX] !== 'DNF' && d[var1.selectedX] !== ""
                                && d[var2.selectedY] !== 'DNF' && d[var2.selectedY] !== ""
                    }))
                    .join("circle")
                    .attr("cx", function (d) {return x(+d[var1.selectedX]);} )
                    .attr("cy", function (d) {
                        const jitter = (Math.random() - 0.5) * y.bandwidth() * 0.7;
                        return y(d[var2.selectedY]) + y.bandwidth() / 2 + jitter; } )
                    .style("fill", "#69b3a2")
                    .attr("r", 5)
                    .attr('opacity', '.55')
                    //used source to create on hover tooltip popup: https://medium.com/@kj_schmidt/show-data-on-mouse-over-with-d3-js-3bf598ff8fc2
                    .on("mouseover", function(event, d){
                        let num =  d[var1.selectedX] + unit1 + ', ' + d[var2.selectedY];
                        console.log(num);
                        tooltip.innerHTML = `${num}`;
                        tooltip.style.left=(event.pageX + 15)  + "px";
                        tooltip.style.top= (event.pageY - 28)  + "px";
                        tooltip.style.visibility="visible";
    
                            d3.select(this)
                            .transition()
                            .duration(300)
                            .attr('opacity', '.85')
                            .style('fill', '#D397F8') 
                            .attr('stroke', 'black')
                            .attr("r", 15)
                            .attr('stroke-width', 2);
                        })
                        .on("mouseout", function(event, d) {
                        //console.log(arcGenerator);
                            d3.select(this)
                                .transition()
                                .duration(500)
                                .style("fill", "#69b3a2")
                                .attr('stroke', 'none')
                                .attr("r", 5)
                            tooltip.style.visibility="hidden";
                        });
                }
                
            }
        }

        function updateNewRadio(varx, vary){
            //CHATGPT assisted in creating function
            //Source: CHATGPT
            let selectedX;
            let selectedY;
            let xClass;
            let yClass;
            
            for(const x of varx){
                //console.log(x);
               if(x.checked){
                selectedX = x.value;
                xClass = x.className;
               } 
            }

            for(const y of vary){
                //console.log(y);
                if(y.checked){
                 selectedY = y.value;
                 yClass = y.className;
                } 
            }

            for(const x of varx){
                if(x.value  === selectedY){
                    //console.log(x);
                    x.disabled = true;
                }
                else{
                    x.disabled = false;
                }
            }

            for(const y of vary){
                if(y.value  === selectedX){
                    //console.log(y);
                    y.disabled = true;
                }
                else{
                    y.disabled = false;
                }
            }

            return [{selectedX, xClass}, {selectedY, yClass}];
        }

        function displayBar(){
            document.getElementById("legend").innerHTML =``;
            document.getElementById("main").innerHTML =
            `
                <h1>
                    Bar Chart/Histogram Visualization
                </h1>
                    <label for="cars">Choose a variable:</label>
                    <!-- categorical
                    name
                    gender
                    representation
                    competition
                    lastround
                    -->
                    <!-- numerical
                    completed solves
                    rank
                    last round time
                    last round avg time
                    how many rounds
                    single time
                    avg time
                    number of comp
                    competitors
                    penalties-->
                    <div>
                    <select name="variables" id="variables">
                        <option value="Name">Name</option>
                        <option value="Gender">Gender</option>
                        <option value="Representation">Representation</option>
                        <option value="Competition">Competition</option>
                        <option value="Last Round">Last Round</option>
                        <option value="Rank">Rank</option>
                        <option value="Last Round Single Time">Last Round Single Time</option>
                        <option value="Last Round Average Time">Last Round Average Time</option>
                        <option value="Completed Solves">Completed Solves</option>
                        <option value="Rounds Competed">Rounds Competed</option>
                        <option value="Best Single Time">Best Single Time</option>
                        <option value="Best Average Time">Best Average Time</option>
                        <option value="Number of Competitions">Number of Competitions</option>
                        <option value="Number of Competitors">Number of Competitors</option>
                        <option value="Number of Penalties">Number of Penalties</option>
                    </select>
                    </div>
            `
            //got function of using .csv from https://stackoverflow.com/questions/42285441/how-to-read-in-csv-with-d3-v4
            //Another source used: https://www.codecademy.com/resources/docs/d3/selection/csv
            d3.csv("../csvData/updatedData.csv").then(function(data) {
                console.log(data);
                updateGraph('Name', data);

                d3.select("#variables").on('change', function(){
                    const varName = document.getElementById('variables').value;
                    console.log(varName);
    
                    updateGraph(varName, data);
                });
            })
        }

        function updateGraph(varName, data){
            const tooltip = document.getElementById('tooltip')
            d3.select("#graph").html("");

            const svg = d3.select("#graph")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            
            const counts = new Map();
            data.forEach(function(d) {
                const value = d[varName];
                if(counts.has(value)){
                    counts.set(value, counts.get(value)+ 1);
                }
                else{
                    if((varName === 'Last Round Average Time' && value == 'DNF') || value === ""){
                        return;                         
                    }
                    counts.set(value, 1);
                }
            });

            let countsArray = Array.from(counts, function(array){
                return {value: array[0], count: array[1]}
            })
            //console.log("COUNT ARRAY");
            //console.log(countsArray);
            
            const isNumerical = !isNaN(+data[0][varName]);
            //console.log(isNumerical, +data[0][varName]);
            if(!isNumerical){
                //Template from: https://d3-graph-gallery.com/graph/barplot_basic.html
                orderedCounts = Array.from(counts).sort(function(a, b){
                    return b[1] - a[1];
                }).map(function(array){
                    return {value: array[0], count: array[1]}
                })
    
                const top11 = orderedCounts.slice(0,11);
                let sum = 0;
                for(const x of top11){
                    console.log(x.count);
                    sum += x.count;
                }
                
                const other = data.length - sum;
    
                console.log(other)
    
                if(other > 0){
                    top11.push({value: 'Others', count: other});
                }

                if(varName == 'Competition'){countsArray = top11};
                //console.log("TOP 11", top11);
                //console.log(countsArray);

                const x = d3.scaleBand()
                    .range([ 0, width ])
                    .domain(countsArray.map(function(d) {
                        return d.value; }))
                    .padding(0.2);
                
                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .attr("transform", "translate(-10,0)rotate(-45)")
                    .style("text-anchor", "end");
                //labeling from: https://stackoverflow.com/questions/11189284/d3-axis-labeling
                svg.append("text")
                    .attr("text-anchor", "middle")
                    .attr("x", width / 2)
                    .attr("y", height + margin.bottom - 10)
                    .text(varName)
                    .style("font-size", "17px")
                    .style("font-weight", "bold");
                
                // Add Y axis
                const y = d3.scaleLinear()
                    .domain([0, d3.max(countsArray, function(d){
                        return d.count;
                    })])
                    .range([ height, 0]);
                
                svg.append("g")
                    .call(d3.axisLeft(y));
                //labeling from: https://stackoverflow.com/questions/11189284/d3-axis-labeling
                svg.append("text")
                    .attr("text-anchor", "middle")
                    .attr("x", -height / 2) 
                    .attr("y", -margin.left+150) 
                    .attr("transform", "rotate(-90)")
                    .text("Frequency")
                    .style("font-size", "17px")
                    .style("font-weight", "bold");
                
                // Bars
                svg.selectAll("rect")
                    .data(countsArray)
                    .enter()
                    .append("rect")
                    .attr("x", function(d) {
                        //console.log(d);
                        return x(d.value);
                    })
                    .attr("y", function(d) { return y(d.count); })
                    .attr("width", x.bandwidth())
                    .attr("height", function(d) { return height - y(d.count); })
                    .attr("fill", "#69b3a2")
                    //used source to create on hover tooltip popup: https://medium.com/@kj_schmidt/show-data-on-mouse-over-with-d3-js-3bf598ff8fc2
                    .on("mouseover", function(event, d){
                        let num =  d.value + ', ' + d.count;
                        console.log(num);
                        tooltip.innerHTML = `${num}`;
                        tooltip.style.left=(event.pageX + 15)  + "px";
                        tooltip.style.top= (event.pageY - 28)  + "px";
                        tooltip.style.visibility="visible";
    
                        d3.select(this)
                            .transition()
                            .duration(300)
                            .attr('opacity', '.85')
                            .style('fill', '#D397F8') 
                            .attr('stroke', 'black') 
                            .attr('stroke-width', 2);
                        })
                    .on("mouseout", function(event, d) {
                        //console.log(arcGenerator);
                            d3.select(this)
                                .transition()
                                .duration(500)
                                .style("fill", "#69b3a2")
                                .attr('stroke', 'none')
                            tooltip.style.visibility="hidden";
                        });

                        console.log("IN THE WRONG PLACE")
            }
            else{
                //Template from: https://d3-graph-gallery.com/graph/histogram_binSize.html
                const unit = ' ' + getUnit(varName)
                const thresholds = [];
                const valueArray = Array.from(counts, function(array){
                    if(Number(array[0]) == 0){
                        console.log(array)
                    }
                    return Number(array[0]);
                });
                //console.log("VALUE ARRAY");
                //console.log(valueArray);

                const max = Math.max(...valueArray);
                const min = Math.min(...valueArray);
                const binSize = ((max - min)/11);
                console.log("BINSIZE", binSize)
                let newBinSize;
                let domainMax = max + binSize;
                
                //Used source to understand binning and creating my own thresholds: https://observablehq.com/@d3/d3-bin
                //Another Source used: https://d3js.org/d3-array/bin#bin_thresholds
                if(varName == 'Rank' || varName == 'Completed Solves'|| varName == 'Rounds Competed' 
                    || varName == 'Number of Competitions' || varName == 'Number of Competitors' || varName == 'Number of Penalties'){
                    if(varName == 'Rounds Competed' || varName == 'Number of Penalties'){
                        newBinSize = 1;
                        domainMax = max + newBinSize;
                    }
                    else{
                        newBinSize = Math.round(binSize);
                        domainMax = max + newBinSize;
                        console.log(newBinSize)
                    }

                    for (let i = min; i <= domainMax; i += newBinSize) {
                        //console.log(i);
                        thresholds.push(i);
                    }
                }
                else{
                    for (let i = min; i <= domainMax; i += binSize) {
                        thresholds.push(parseFloat(i.toFixed(2)));
                    }
                }

                const x = d3.scaleLinear() 
                    .range([0, width])
                    .domain([min, domainMax]);
                //Used this source to create tick marks on X axis based on my thresholds: https://www.geeksforgeeks.org/d3-js-axis-tickvalues-function/#
                //Another Source used: https://d3js.org/d3-axis
                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x).ticks(thresholds.length).tickValues(thresholds));

                //labeling from: https://stackoverflow.com/questions/11189284/d3-axis-labeling
                svg.append("text")
                    .attr("text-anchor", "middle")
                    .attr("x", width / 2)
                    .attr("y", height + margin.bottom - 20)
                    .text(varName + ' (' + unit.substring(1) + ')')
                    .style("font-size", "17px")
                    .style("font-weight", "bold");

                console.log("THRESHOLDS", thresholds);
                
                const histogram = d3.histogram()
                    .value(function(d) { 
                        console.log(varName);
                        return d[varName]; })   // I need to give the vector of value
                    .domain(x.domain())  // then the domain of the graphic
                    .thresholds(thresholds);
                
                const bins = histogram(data);
                console.log("BINS: ", bins)
                //const bins = d3.bin(data);
                const y = d3.scaleLinear()
                    .range([height, 0])
                    .domain([0, d3.max(bins, function(d){
                        console.log(d.count);
                        return d.length;
                    })]);

                svg.append("g")
                    .call(d3.axisLeft(y));
                
                //labeling from: https://stackoverflow.com/questions/11189284/d3-axis-labeling
                svg.append("text")
                    .attr("text-anchor", "middle")
                    .attr("x", -height / 2) 
                    .attr("y", -margin.left+150) 
                    .attr("transform", "rotate(-90)")
                    .text("Frequency")
                    .style("font-size", "17px")
                    .style("font-weight", "bold");

                    //console.log(bins);
                svg.selectAll("rect")
                    .data(bins)
                    .join("rect")
                    .attr("x", 1)
                    .attr("transform", function(d) { return `translate(${x(d.x0)} , ${y(d.length)})`})
                    .attr("width", function(d) {
                        console.log("WIDTH", d)
                        if(x(d.x1) - x(d.x0) -1 < 0){
                            return binSize-1;
                        }
                        return x(d.x1) - x(d.x0) -1})
                    .attr("height", function(d) { return height - y(d.length); })
                    .style("fill", "#69b3a2")
                    //used source to create on hover tooltip popup: https://medium.com/@kj_schmidt/show-data-on-mouse-over-with-d3-js-3bf598ff8fc2
                    .on("mouseover", function(event, d){
                        let num = '[' + d.x0 + ' - '+  parseFloat(d.x1.toFixed(2)) + ')' + unit + ', ' + d.length;
                        console.log(num);
                        tooltip.innerHTML = `${num}`;
                        tooltip.style.left=(event.pageX + 15)  + "px";
                        tooltip.style.top= (event.pageY - 28)  + "px";
                        tooltip.style.visibility="visible";
    
                            d3.select(this)
                            .transition()
                            .duration(300)
                            .attr('opacity', '.85')
                            .style('fill', '#D397F8') 
                            .attr('stroke', 'black') 
                            .attr('stroke-width', 2);
                        })
                        .on("mouseout", function(event, d) {
                        //console.log(arcGenerator);
                            d3.select(this)
                                .transition()
                                .duration(500)
                                .style("fill", "#69b3a2")
                                .attr('stroke', 'none')
                            tooltip.style.visibility="hidden";
                        });
            }
        }
    </script>
</body>
</html>