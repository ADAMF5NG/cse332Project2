<!DOCTYPE html>
<html>
<head>
  <!-- <link rel="stylesheet" href="css/index.css"> -->
  <!-- <script type="module" src="src/index.js"></script> -->
  <meta charset="utf-8">
  <script type="text/javascript" src="../d3/d3.v7.js"></script>
  <!-- <script src="https://d3js.org/d3.v7.min.js"></script> -->
  <!-- <script src="../src/index.js" defer></script> -->
</head>
<body>
    <h1>
        CSE 332 PROJECT 2 <br>
        Adam Feng
    </h1>
  <div>
    <div>
        Choose Visualization:
        <button id="bar">Bar Chart/Histogram</button>
        <button id="pie">Pie Chart</button>
        <button id="scatter">Scatter Plot</button>
    </div>
    <div id="main"> 

    </div>

    <div id="graph"></div>

    <script>
        const margin = {top: 30, right: 30, bottom: 100, left: 60},
            width = 1000 - margin.left - margin.right,
            height = 1000 - margin.top - margin.bottom;
        
        window.onload = function(){
            document.getElementById("bar").onclick = function(){
                displayBar();
            };

            document.getElementById("scatter").onclick = function(){
                document.getElementById("graph").innerHTML =``;
                displayScatter();
            };

            document.getElementById("pie").onclick = function(){
                document.getElementById("graph").innerHTML =``;
                displayPie();
            };
        }

        function displayPie(){
            document.getElementById("main").innerHTML =
            `
                <h1>
                    Pie Chart Visualization
                </h1>
                    <label for="cars">Choose a variable:</label>
                    <!-- categorical
                    name
                    gender
                    representation
                    competition
                    lastround
                    -->
                    <!-- numerical
                    completed solves
                    rank
                    last round time
                    last round avg time
                    how many rounds
                    single time
                    avg time
                    number of comp
                    competitors
                    penalties-->
                    <div>
                    <select name="variables" id="variables">
                        <option value="Name">Name</option>
                        <option value="Gender">Gender</option>
                        <option value="Representation">Representation</option>
                        <option value="Competition">Competition</option>
                        <option value="Last Round">Last Round</option>
                        <option value="Rank">Rank</option>
                        <option value="Last Round Single Time (during competition)">Last Round Single Time</option>
                        <option value="Last Round Average Time (during competition)">Last Round Average Time</option>
                        <option value="Completed Solves (Total)">Completed Solves</option>
                        <option value="How many rounds did they compete in">Rounds Competed</option>
                        <option value="Best Single Time">Best Single Time</option>
                        <option value="Best Average Time">Best Average Time</option>
                        <option value="How many Competitions have they done?">Number of Competitions</option>
                        <option value="Competitors">Number of Competitors</option>
                        <option value="Penalties (DNF)">Number of Penalties</option>
                    </select>
                    </div>
            `
            d3.csv("../csvData/dataSet1.csv").then(function(data) {
                console.log(data);
                updatePie('Name', data);

                d3.select("#variables").on('change', function(){
                    const varName = document.getElementById('variables').value;
                    console.log(varName);
    
                    updatePie(varName, data);
                });
            })
        }

        function updatePie(varName, data){
            document.getElementById("graph").innerHTML =``;

            const counts = new Map();
            data.forEach(function(d) {
                const value = d[varName];
                if(counts.has(value)){
                    counts.set(value, counts.get(value)+ 1);
                }
                else{
                    if((varName === 'Last Round Average Time (during competition)' && value == 'DNF') || value === ""){
                        return;                         
                    }
                    counts.set(value, 1);
                }
            });

            const valueArray = Array.from(counts, function(array){
                if(Number(array[0]) == 0){
                    console.log(array)
                }
                return Number(array[0]);
            });


            const isNumerical = !isNaN(+data[0][varName]);
    
            //console.log("SHOWING COUNTS",  orderedCounts);
            const margin = {top: 30, right: 30, bottom: 100, left: 60},
            width = 1000 - margin.left - margin.right,
            height = 1000 - margin.top - margin.bottom;
            
        // The radius of the pieplot is half the width or half the height (smallest one). I subtract a bit of margin.
            const radius = Math.min(width, height) / 2 - margin.bottom
            
            // append the svg object to the div called 'my_dataviz'
            const svg = d3.select("#graph")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${width / 2}, ${height / 2})`);
            
            // shape helper to build arcs:
            const arcGenerator = d3.arc()
                .innerRadius(0)
                .outerRadius(radius)
            
            const outerArc = d3
                .arc()
                .innerRadius(radius * 1.1)
                .outerRadius(radius * 1.1);
            
            svg.append("g")
                .attr("class", "slices");
            svg.append("g")
                .attr("class", "labels");
            svg.append("g")
                .attr("class", "lines");
            
            if(!isNumerical){
                orderedCounts = Array.from(counts).sort(function(a, b){
                    return b[1] - a[1];
                })
    
                const top5 = orderedCounts.slice(0,5);
                let sum = 0;
                for(const x of top5){
                    console.log(x[1]);
                    sum += x[1];
                }
                
                const other = data.length - sum;
    
                console.log(top5)
    
                if(other > 0){
                    top5.push(['Others', other]);
                }

                pie1 = d3.pie()
                    .value(function(d){
                        return d[1];
                    })
            
                data_ready = pie1(top5);

                color = d3.scaleOrdinal()
                    .domain(top5.map(function(d){
                        return d[0];
                    }))
                    .range(d3.schemeSet3);
                
                svg.selectAll('mySlices')
                    .data(data_ready)
                    .join('path')
                    .attr('d', arcGenerator)
                    .attr('fill', function(d){ return(color(d.data[0])) })
                    .attr("stroke", "black")
                    .style("stroke-width", "2px")
                    .style("opacity", 0.7)
                    .on("mouseover", function(event, d){
                        //console.log("MOUSE OVER")
                        d3.select(this)
                        .transition()
                        .duration(300)
                        .attr('d', d3.arc()
                            .innerRadius(0)  
                            .outerRadius(radius + 10)
                        );
                    })
                    .on("mouseout", function(event, d) {
                        //console.log(arcGenerator);
                        d3.select(this)
                            .transition()
                            .duration(300)
                            .attr('d', arcGenerator);
                    });
                
                svg.select(".lines").selectAll("polyline")
                    .data(data_ready)
                    .enter()
                    .append("polyline")
                    .attr('points', function(d, i) {
                        var outsidePos = outerArc.centroid(d);
                        outsidePos[0] = (radius * 1.4 * (midAngle(d) < Math.PI ? 1 : -1)); // Position outside pie
                        return [arcGenerator.centroid(d), outerArc.centroid(d), outsidePos]; // Draw line from slice to outside text
                    })
                    .style('fill', 'none')
                    .style('stroke', 'black')
                    .style('stroke-width', 1);
        
                function midAngle(d){
                    console.log(d.startAngle + (d.endAngle - d.startAngle)/2)
                    return d.startAngle + (d.endAngle - d.startAngle)/2;
                }
                
                // Now add the annotation. Use the centroid method to get the best coordinates
                svg.selectAll('mySlices')
                    .data(data_ready)
                    .join('text')
                    .text(function(d){
                        console.log(d.data[0])
                       return d.data[0]})
                    .attr("transform", function(d) { 
                        let position = outerArc.centroid(d)
                        position[0] = radius *  1.3 * (midAngle(d) < Math.PI ? 1 : -1);
                        
                        //position[1] = radius  * position[1] / Math.abs(position[1]);
                        console.log(position)
                        return "translate("+ position +")"})
                    //.style("text-anchor", "middle")
                    .style("font-size", 17)
            }
            else{
                const max = Math.max(...valueArray);
                const min = Math.min(...valueArray);
                const binSize = ((max - min)/6);

                const thresholds = [];
                for (let i = min; i <= max; i += binSize) {
                    thresholds.push(parseFloat(i.toFixed(2)));
                }

                const bin1 = d3.bin()
                .domain([min, max])
                .thresholds(thresholds);
            
                const bins = bin1(valueArray);
                console.log(bins);

                let binnedData = bins.map(function(value){
                    return {
                        intervals: `${value.x0}-${value.x1}`,
                        count: value.length
                    }
                })

                pie1 = d3.pie()
                .value(function(d){
                    return d.count;
                })
            
                data_ready = pie1(binnedData)

                color = d3.scaleOrdinal()
                    .range(d3.schemeSet3);

                svg.selectAll('mySlices')
                    .data(data_ready)
                    .join('path')
                    .attr('d', arcGenerator)
                    .attr('fill', function(d){ return(color(d.data.intervals)) })
                    .attr("stroke", "black")
                    .style("stroke-width", "2px")
                    .style("opacity", 0.7)
                
                // Now add the annotation. Use the centroid method to get the best coordinates
                //svg.selectAll('mySlices')
                //    .data(data_ready)
                //    .join('text')
                //   .text(function(d){
                //       //console.log(d)
                //        return d.data.intervals})
                //    .attr("transform", function(d) { return `translate(${arcGenerator.centroid(d)})`})
                //    .style("text-anchor", "middle")
                //    .style("font-size", 17)

            }
        }

        function displayScatter(){
            document.getElementById("main").innerHTML =
            `
                <h1>
                    Scatter Plot Visualization
                </h1>
                <h3>Select X Variable</h3>
                <label><input type="radio" name="xVariable" class="Cat" value="Name" checked> Name</label>
                <label><input type="radio" name="xVariable" class="Cat" value="Gender"> Gender</label>
                <label><input type="radio" name="xVariable" class="Cat" value="Representation"> Representation</label>
                <label><input type="radio" name="xVariable" class="Cat" value="Competition"> Competition</label>
                <label><input type="radio" name="xVariable" class="Cat" value="Last Round"> Last Round</label>
                <label><input type="radio" name="xVariable" class="Num" value="Rank">Rank</label>
                <label><input type="radio" name="xVariable" class="Num" value="Last Round Single Time (during competition)">Last Round Single Time</label>
                <label><input type="radio" name="xVariable" class="Num" value="Last Round Average Time (during competition)">Last Round Average Time</label>
                <label><input type="radio" name="xVariable" class="Num" value="Completed Solves (Total)">Completed Solves</label>
                <label><input type="radio" name="xVariable" class="Num" value="How many rounds did they compete in">Rounds Competed</label>
                <label><input type="radio" name="xVariable" class="Num" value="Best Single Time">Best Single Time</label>
                <label><input type="radio" name="xVariable" class="Num" value="Best Average Time">Best Average Time</label>
                <label><input type="radio" name="xVariable" class="Num" value="How many Competitions have they done?">Number of Competitions</label>
                <label><input type="radio" name="xVariable" class="Num" value="Competitors">Number of Competititors</label>
                <label><input type="radio" name="xVariable" class="Num" value="Penalties (DNF)">Number of Penalties</label>


                <h3>Select Y Variable</h3>
                <label><input type="radio" name="yVariable" class="Cat" value="Name"> Name</label>
                <label><input type="radio" name="yVariable" class="Cat" value="Gender"> Gender</label>
                <label><input type="radio" name="yVariable" class="Cat" value="Representation"> Representation</label>
                <label><input type="radio" name="yVariable" class="Cat" value="Competition"> Competition</label>
                <label><input type="radio" name="yVariable" class="Cat" value="Last Round"> Last Round</label>
                <label><input type="radio" name="yVariable" class="Num" value="Rank">Rank</label>
                <label><input type="radio" name="yVariable" class="Num" value="Last Round Single Time (during competition)" checked>Last Round Single Time</label>
                <label><input type="radio" name="yVariable" class="Num" value="Last Round Average Time (during competition)">Last Round Average Time</label>
                <label><input type="radio" name="yVariable" class="Num" value="Completed Solves (Total)">Completed Solves</label>
                <label><input type="radio" name="yVariable" class="Num" value="How many rounds did they compete in">Rounds Competed</label>
                <label><input type="radio" name="yVariable" class="Num" value="Best Single Time">Best Single Time</label>
                <label><input type="radio" name="yVariable" class="Num" value="Best Average Time">Best Average Time</label>
                <label><input type="radio" name="yVariable" class="Num" value="How many Competitions have they done?">Number of Competitions</label>
                <label><input type="radio" name="yVariable" class="Num" value="Competitors">Number of Competititors</label>
                <label><input type="radio" name="yVariable" class="Num" value="Penalties (DNF)">Number of Penalties</label>
            `

            const xRadios = document.getElementsByName("xVariable");
            const yRadios = document.getElementsByName("yVariable");
            let selected = updateNewRadio(xRadios, yRadios);
            
            d3.csv("../csvData/dataSet1.csv").then(function(data) {
                console.log(data);
                updateScatter(selected[0], selected[1], data);
            
            //console.log(xRadios);
                for(const x of xRadios){
                    x.onclick = function(){
                        selected = updateNewRadio(xRadios, yRadios);
                        updateScatter(selected[0], selected[1], data);
                    }
                }

                for(const y of yRadios){
                    y.onclick = function(){
                        selected = updateNewRadio(xRadios, yRadios);
                        updateScatter(selected[0], selected[1], data);
                    }
                }
            })

        }

        function updateScatter(var1, var2, data){
            document.getElementById("graph").innerHTML =``;
            console.log(var1);

            const countsX = new Map();
            data.forEach(function(d) {
                const value = d[var1.selectedX];
                if(countsX.has(value)){
                    countsX.set(value, countsX.get(value)+ 1);
                }
                else{
                    if((var1.selectedX === 'Last Round Average Time (during competition)' && value == 'DNF') || value === ""){
                        return;                         
                    }
                    countsX.set(value, 1);
                }
            });

            const valueArrayX = Array.from(countsX, function(array){
                if(Number(array[0]) == 0){
                    console.log(array)
                }
                return Number(array[0]);
            });

            const maxX = Math.max(...valueArrayX);
            const minX = Math.min(...valueArrayX);

            const countsY = new Map();
            data.forEach(function(d) {
                const value = d[var2.selectedY];
                if(countsY.has(value)){
                    countsY.set(value, countsY.get(value)+ 1);
                }
                else{
                    if((var2.selectedY === 'Last Round Average Time (during competition)' && value == 'DNF') || value === ""){
                        return;                         
                    }
                    countsY.set(value, 1);
                }
            });
            //should simplify

            const valueArrayY = Array.from(countsY, function(array){
                if(Number(array[0]) == 0){
                    console.log(array)
                }
                return Number(array[0]);
            });

            const maxY = Math.max(...valueArrayY);
            const minY = Math.min(...valueArrayY);

            const svg = d3.select("#graph")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            //console.log(var1)
            //console.log(var2)

            //console.log("HELLO",data.filter(function(d){
            //    return !isNaN(d[var1.selectedX]) && !isNaN(d[var2.selectedY]) 
            //            && d[var1.selectedX] !== 'DNF' && d[var1.selectedX] !== ""
            //            && d[var2.selectedY] !== 'DNF' && d[var2.selectedY] !== ""
            //}));
            const isNumerical = var1.xClass == 'Num' && var2.yClass == 'Num';
            const bothCat = var1.xClass == 'Cat' && var2.yClass == 'Cat';
            if(isNumerical){    
                const x = d3.scaleLinear()
                    .domain([0, maxX])
                    .range([ 0, width ]);

                svg.append("g")
                    .attr("transform", `translate(0, ${height})`)
                    .call(d3.axisBottom(x));

                    // Add Y axis
                const y = d3.scaleLinear()
                    .domain([0, maxY])
                    .range([ height, 0]);

                svg.append("g")
                    .call(d3.axisLeft(y));

                    // Add dots
                svg.append('g')
                    .selectAll("dot")
                    .data(data.filter(function(d){
                        return  d[var1.selectedX] !== 'DNF' && d[var1.selectedX] !== ""
                                && d[var2.selectedY] !== 'DNF' && d[var2.selectedY] !== ""
                    }))
                    .join("circle")
                    .attr("cx", function (d) { 
                        //console.log(d[var1.selectedX]);
                        return x(+d[var1.selectedX]); } )
                    .attr("cy", function (d) { return y(+d[var2.selectedY]); } )
                    .attr("r", 1.5)
                    .style("fill", "#69b3a2")
            }
            else if(bothCat){
                const x = d3.scaleBand()
                    .range([ 0, width ])
                    .domain(data.map(function(d) {
                        return d[var1.selectedX]; }))
                    .padding(0.2);
                console.log("IM IN HERE")

                svg.append("g")
                    .attr("transform", `translate(0, ${height})`)
                    .call(d3.axisBottom(x));

                    // Add Y axis
                const y = d3.scaleBand()
                    .range([ height, 0])
                    .domain(data.map(function(d) {
                        return d[var2.selectedY]; }))
                    .padding(0.2);

                svg.append("g")
                    .call(d3.axisLeft(y));

                    // Add dots
                svg.append('g')
                    .selectAll("dot")
                    .data(data)
                    .join("circle")
                    .attr("cx", function (d) { 
                        const jitter = (Math.random() - 0.5) *  x.bandwidth() * 0.7;
                        return x(d[var1.selectedX]) + x.bandwidth() / 2 + jitter; } )
                    .attr("cy", function (d) {
                        const jitter = (Math.random() - 0.5) * y.bandwidth() * 0.7;
                        return y(d[var2.selectedY]) + y.bandwidth() / 2 + jitter; } )
                    .attr("r", 2)
                    .style("fill", "#69b3a2")
                    .style("opacity", 0.8)
            }
            else{
                let x;
                let y;
                if(var1.xClass == 'Cat'){
                    x = d3.scaleBand()
                        .range([ 0, width ])
                        .domain(data.map(function(d) {
                            return d[var1.selectedX]; }))
                        .padding(0.2);
                    
                    y = d3.scaleLinear()
                        .domain([0, maxY])
                        .range([ height, 0]);
                    
                }
                else if(var1.xClass == 'Num'){
                    x = d3.scaleLinear()
                        .domain([0, maxX])
                        .range([ 0, width ]);
                    
                    y = d3.scaleBand()
                        .range([ height, 0])
                        .domain(data.map(function(d) {
                            return d[var2.selectedY]; }))
                        .padding(0.2);
                }

                svg.append("g")
                    .attr("transform", `translate(0, ${height})`)
                    .call(d3.axisBottom(x));
                
                svg.append("g")
                    .call(d3.axisLeft(y));

                if(var1.xClass == 'Cat'){
                    svg.append('g')
                    .selectAll("dot")
                    .data(data.filter(function(d){
                        return d[var1.selectedX] !== 'DNF' && d[var1.selectedX] !== ""
                                && d[var2.selectedY] !== 'DNF' && d[var2.selectedY] !== ""
                    }))
                    .join("circle")
                    .attr("cx", function (d) { 
                        const jitter = (Math.random() - 0.5) *  x.bandwidth() * 0.7;
                        return x(d[var1.selectedX]) + x.bandwidth() / 2 + jitter; } )
                    .attr("cy", function (d) {return y(+d[var2.selectedY])})
                    .attr("r", 2)
                    .style("fill", "#69b3a2")
                    .style("opacity", 0.8)
                }
                else if(var1.xClass == 'Num'){
                    svg.append('g')
                    .selectAll("dot")
                    .data(data.filter(function(d){
                        return d[var1.selectedX] !== 'DNF' && d[var1.selectedX] !== ""
                                && d[var2.selectedY] !== 'DNF' && d[var2.selectedY] !== ""
                    }))
                    .join("circle")
                    .attr("cx", function (d) {return x(+d[var1.selectedX]);} )
                    .attr("cy", function (d) {
                        const jitter = (Math.random() - 0.5) * y.bandwidth() * 0.7;
                        return y(d[var2.selectedY]) + y.bandwidth() / 2 + jitter; } )
                    .attr("r", 2)
                    .style("fill", "#69b3a2")
                    .style("opacity", 0.8)
                }
            }
        }

        function updateNewRadio(varx, vary){
            let selectedX;
            let selectedY;
            let xClass;
            let yClass;
            
            for(const x of varx){
                //console.log(x);
               if(x.checked){
                selectedX = x.value;
                xClass = x.className;
               } 
            }

            for(const y of vary){
                //console.log(y);
                if(y.checked){
                 selectedY = y.value;
                 yClass = y.className;
                } 
            }

            for(const x of varx){
                if(x.value  === selectedY){
                    //console.log(x);
                    x.disabled = true;
                }
                else{
                    x.disabled = false;
                }
            }

            for(const y of vary){
                if(y.value  === selectedX){
                    //console.log(y);
                    y.disabled = true;
                }
                else{
                    y.disabled = false;
                }
            }

            return [{selectedX, xClass}, {selectedY, yClass}];
        }

        
        function displayBar(){
            document.getElementById("main").innerHTML =
            `
                <h1>
                    Bar Chart/Histogram Visualization
                </h1>
                    <label for="cars">Choose a variable:</label>
                    <!-- categorical
                    name
                    gender
                    representation
                    competition
                    lastround
                    -->
                    <!-- numerical
                    completed solves
                    rank
                    last round time
                    last round avg time
                    how many rounds
                    single time
                    avg time
                    number of comp
                    competitors
                    penalties-->
                    <div>
                    <select name="variables" id="variables">
                        <option value="Name">Name</option>
                        <option value="Gender">Gender</option>
                        <option value="Representation">Representation</option>
                        <option value="Competition">Competition</option>
                        <option value="Last Round">Last Round</option>
                        <option value="Rank">Rank</option>
                        <option value="Last Round Single Time (during competition)">Last Round Single Time</option>
                        <option value="Last Round Average Time (during competition)">Last Round Average Time</option>
                        <option value="Completed Solves (Total)">Completed Solves</option>
                        <option value="How many rounds did they compete in">Rounds Competed</option>
                        <option value="Best Single Time">Best Single Time</option>
                        <option value="Best Average Time">Best Average Time</option>
                        <option value="How many Competitions have they done?">Number of Competitions</option>
                        <option value="Competitors">Number of Competitors</option>
                        <option value="Penalties (DNF)">Number of Penalties</option>
                    </select>
                    </div>
            `
            
            d3.csv("../csvData/dataSet1.csv").then(function(data) {
                console.log(data);
                updateGraph('Name', data);

                d3.select("#variables").on('change', function(){
                    const varName = document.getElementById('variables').value;
                    console.log(varName);
    
                    updateGraph(varName, data);
                });
            })
        }
        //d3.csv("../csvData/dataSet1.csv").then(function(data) {
        //    console.log(data);
            // Set up visualization, scales, etc.
            //updateGraph('Name');

        //    d3.select("input[name='variable']").on('change', function(){
                //const varNames = document.getElementById('variables').value;
        //        console.log(varName);

        //        updateGraph(varName);
        //    });
        //}).catch(function(error){
        //    console.error("Error loading the CSV file: " + error);
        //});

        function updateGraph(varName, data){
            d3.select("#graph").html("");

            const svg = d3.select("#graph")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            
            const counts = new Map();
            data.forEach(function(d) {
                const value = d[varName];
                if(counts.has(value)){
                    counts.set(value, counts.get(value)+ 1);
                }
                else{
                    if((varName === 'Last Round Average Time (during competition)' && value == 'DNF') || value === ""){
                        return;                         
                    }
                    counts.set(value, 1);
                }
            });

            const values = data.map(function(d){
                return d[varName];
            })
            //console.log("VALUES");
            //console.log(values);

            const countsArray = Array.from(counts, function(array){
                return {value: array[0], count: array[1]}
            })
            //console.log("COUNT ARRAY");
            //console.log(countsArray);

            
            const isNumerical = !isNaN(+data[0][varName]);
            if(!isNumerical){
                const x = d3.scaleBand()
                    .range([ 0, width ])
                    .domain(countsArray.map(function(d) {
                        return d.value; }))
                    .padding(0.2);
                
                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .attr("transform", "translate(-10,0)rotate(-45)")
                    .style("text-anchor", "end");
                
                // Add Y axis
                const y = d3.scaleLinear()
                    .domain([0, d3.max(countsArray, function(d){
                        return d.count;
                    })])
                    .range([ height, 0]);
                
                svg.append("g")
                    .call(d3.axisLeft(y));
                
                // Bars
                svg.selectAll("rect")
                    .data(countsArray)
                    .enter()
                    .append("rect")
                    .attr("x", function(d) {
                        //console.log(d);
                        return x(d.value);
                    })
                    .attr("y", function(d) { return y(d.count); })
                    .attr("width", x.bandwidth())
                    .attr("height", function(d) { return height - y(d.count); })
                    .attr("fill", "#69b3a2")
                
                
            }
            else{
                const valueArray = Array.from(counts, function(array){
                    if(Number(array[0]) == 0){
                        console.log(array)
                    }
                    return Number(array[0]);
                });
                console.log("VALUE ARRAY");
                console.log(valueArray);

                const max = Math.max(...valueArray);
                const min = Math.min(...valueArray);
                const binSize = ((max - min)/12);
                

                const x = d3.scaleLinear() 
                    .range([0, width])
                    .domain([min, max + binSize]);

                const thresholds = [];
                for (let i = min; i <= max + binSize; i += binSize) {
                    thresholds.push(parseFloat(i.toFixed(2)));
                }
                
                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x).ticks(thresholds.length).tickValues(thresholds));

                console.log(thresholds);
                
                const histogram = d3.histogram()
                    .value(function(d) { 
                        console.log(varName);
                        return d[varName]; })   // I need to give the vector of value
                    .domain(x.domain())  // then the domain of the graphic
                    .thresholds(thresholds);
                
                const bins = histogram(data);
                console.log("BINS: ", bins)
                //const bins = d3.bin(data);
                const y = d3.scaleLinear()
                    .range([height, 0])
                    .domain([0, d3.max(bins, function(d){
                        console.log(d.count);
                        return d.length;
                    })]);
                
                svg.append("g")
                    .call(d3.axisLeft(y));
                    //console.log(bins);
                svg.selectAll("rect")
                    .data(bins)
                    .join("rect")
                    .attr("x", 1)
                    .attr("transform", function(d) { return `translate(${x(d.x0)} , ${y(d.length)})`})
                    .attr("width", function(d) {
                        console.log("WIDTH", d)
                        if(x(d.x1) - x(d.x0) -1 < 0){
                            return binSize-1;
                        }
                        return x(d.x1) - x(d.x0) -1})
                    .attr("height", function(d) { return height - y(d.length); })
                    .style("fill", "#69b3a2");
                    
            }
        }
        
    </script>
</body>
</html>